## design_impl_redis_note

### redis db

1. Redis服务器的所有数据都保存在redisServer.db数组中，数据库数量由redisServer.dbnum确定
2. Client通过修改目标数据库指针，让它指向redisServer.db数组中的不同元素来切换不同的数据库
3. redist db主要由dict和expires两个字典构成，其中dict保存键值对，expires保存键值的过期时间
4. 数据库由字典构成，因此对数据库的操作都是建立在字典操作之上的
5. 数据库的键总是一个字符串对象，而值则可以是任意一种Redis对象类型
6. expires字典的键指向数据库中的某个键，而值则记录了数据库键的过期时间，过期时间是一个以毫秒为单位的UNIX时间戳
7. Redis使用惰性删除和定期删除两种策略来删除过期的键：惰性删除策略只在碰到过期键时才进行删除操作，定期删除策略则每隔一段时间主动查找并删除过期键
8. 执行save（bgsave）命令索产生的新RDB文件不包含已经过期的键
9. 执行BGREWRITEAOF所产生的重写AOF文件不会包含已经过期的键
10. 当一个过期键被删除之后，服务器会追加一条DEL命令到现有AOF文件的末尾，显示地删除过期键
11. 当主服务器删除一个过期键之后，它会向所有从服务器发送一条DEL命令，显式第删除过期键
12. slave即使发现过期key也不会主动删除，而是等待master发来DEL命令，这种统一、中心化的过期键删除策略可以保证master和slave的一致性
13. 当Redis命令对数据库进行修改之后，服务器会根据配置向客户端发送数据库通知
